<!DOCTYPE html>
<html lang="se">
<head>
    <title>Klimatbil | Klimatkompensera</title>

    <!-- Meta
    ================================================== -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Marcus Otterström" />
    <meta name="description" content="Klimatbil erbjuder dig ett enkelt sätt att klimatkompensera utsläppen från dina fordon. Billigt, snabbt och enkelt!" />
    <meta name="keywords" content="klimatbil,klimatkompensera,enkelt,bil,fordon,klimatkompensera enkelt,klimatkompensera bil,klimatkompensera fordon,klimat,kompensera,miljö,miljöbil" />
    <meta name="theme-color" content="#85c040" />

    <meta property="og:site_name" content="Klimatbil" />
    <meta property="og:title" content="Klimatbil | Klimatkompensera" />
    <meta property="og:description" content="Klimatbil erbjuder dig ett enkelt sätt att klimatkompensera utsläppen från dina fordon. Billigt, snabbt och enkelt!" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://klimatbil.com/" />
    <meta property="og:locale" content="sv_SE" />
    <meta property="og:image" content="https://preview.ibb.co/iXbS7f/klimatbil-uf-logo.png" />
    <meta property="og:image:height" content="1024" />
    <meta property="og:image:width" content="1024" />
    <meta property="og:image:type" content="image/png" />

    <!-- Links
    ================================================== -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="manifest" href="manifest.json" />

    <!-- Important Styles
    ================================================== -->
    <link rel="stylesheet" type="text/css" media="screen" href="css/base.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="css/utility.css" />
</head>
<body>
    <div class="page-wrapper">
        <!-- Top bar
        ================================================== -->
        <div class="top-bar">
            <div class="top-bar-logo">
                <img src="img/logo-128.png" alt="Logotyp för Klimatbil" onclick="SetWindowLocationTo('https://www.klimatbil.com')" />
                <h1 onclick="SetWindowLocationTo('https://www.klimatbil.com/')">Klimatbil</h1>
            </div>
            <div class="nav-bar-toggle" onclick="ToggleNavBar();">
                &#9776
            </div>
        </div>

        <!-- Navigation bar
        ================================================== -->
        <nav class="nav-bar nav-bar-inactive" id="js-nav-bar">
            <ul>
                <li class="nav-link" onclick="SetWindowLocationTo('https://klimatbil.com')">Hem</li>
                <li class="nav-link" onclick="SetWindowLocationTo('https://klimatbil.com/klimatkompensera')">Klimatkompensera</li>
                <li class="nav-link" onclick="SetWindowLocationTo('https://klimatbil.com/om-oss')">Om klimatbil</li>
                <li class="nav-link" onclick="SetWindowLocationTo('https://klimatbil.com/beräkningsmetodik')">Beräkningsmetodik</li>
            </ul>
        </nav>

        <div class="overlap-background transparent-background" id="js-overlap-background"></div>
        <div class="overlap-hide hidden" id="js-overlap-hide" onclick="ToggleNavBar()"></div>

        <!-- Page content
        ================================================== -->
        <div class="content-wrapper" style="text-align: center;"> <!-- Temp inline -->
            <br /> <br /> <br /> <br /> <br /> <br />
            <h1>Kompensera</h1>

            <script>
                // Probably want to move this somewhere
                // and extract into separate methods
                function UpdateTotal()
                {
                    const gasolineMultiplier = 0.00234769703;
                    const dieselMultiplier = 0.0026892715;

                    let literAmount = document.getElementById("js-liter-input").value;
                    let fuelType = document.getElementById("js-fuel-select").value;
                    
                    let emissionMultiplier = 0;

                    switch(fuelType)
                    {
                        case "Bensin":
                            emissionMultiplier = gasolineMultiplier;
                            break;
                        
                        case "Diesel":
                            emissionMultiplier = dieselMultiplier;
                            break;
                        
                        default:
                            alert(`${fuelType} is not a recognized fuel type.`);
                            return;
                    }

                    document.getElementById("js-co2-emission").innerText = `${(literAmount * emissionMultiplier).toFixed(4)}`
                    
                    let customPaymentValue = document.getElementById("js-money-input").value;
                    
                    if (customPaymentValue !== "")
                    {
                        let finalAmount = Math.round(parseInt(customPaymentValue));
                        document.getElementById("js-total-amount").innerText = finalAmount;
                        let form = document.getElementById("js-payment-form");
                        form.action = `https://wt-a1a4d75d2e7f5a03df41a2e03b3cd9d7-0.sandbox.auth0-extend.com/stripe-payment?amount=${finalAmount * 100}&description=custom`;
                    }
                    else
                    {
                        // TODO: Add stripe amount, add service fee
                        let finalAmount = Math.round(literAmount * emissionMultiplier * 240.64171123); // Arbitrary number from myclimate.org;
                        document.getElementById("js-total-amount").innerText = finalAmount;
                        let form = document.getElementById("js-payment-form");
                        form.action = `https://wt-a1a4d75d2e7f5a03df41a2e03b3cd9d7-0.sandbox.auth0-extend.com/stripe-payment?amount=${finalAmount * 100}&description=${literAmount}+liter+${fuelType}`;
                    }
                }
            </script>
            
            <!-- TODO: PROPER STYLING -->
            <span>Kompensera för en tankning<br /><br /></span>

            <form>
                <input id="js-liter-input" type="number" oninput="UpdateTotal()"></input>
                <label for="js-liter-input">Liter</label>
                <select id="js-fuel-select" oninput="UpdateTotal()">
                    <option>Bensin</option>
                    <option>Diesel</option>
                </select>
            </form>
            <h5><span id="js-co2-emission">0.0000</span> ton koldioxid</h5>

            <!-- TODO: PROPER STYLING -->
            <br /> <br />
            <em>eller</em>
            <br /> <br />

            <span>Kompensera valfritt belopp<br /><br /></span>
            <form>
                <input id="js-money-input" type="number" oninput="UpdateTotal()"></input>
                <label for="js-literInput">SEK</label>
            </form>

            <!-- TODO: PROPER STYLING -->
            <br /> <br />

            <h3>Betala <span id="js-total-amount">0</span> kr</h3>
            <form action="" method="POST" id="js-payment-form">
            <script
                src="https://checkout.stripe.com/checkout.js" class="stripe-button" id="js-payment-script"
                data-key="pk_test_bG7vG8DfCvej8dpMZMByDgPZ"
                data-amount="0"
                data-name="Klimatkompensation"
                data-description="Klimatbil UF"
                data-image="https://preview.ibb.co/iXbS7f/klimatbil-uf-logo.png"
                data-locale="sv_SE"
                data-label="Betala med kort"
                data-currency="sek">
            </script>
            </form>
        </div>
    </div>

    <!-- JavaScript
    ================================================== -->
    <script src="js/main.js"></script>

    <!-- Secondary Styles
    ================================================== -->
    <link rel="stylesheet" type="text/css" media="screen" href="css/normalize.css" />

    <!-- McAfee trust mark
    ================================================== -->
    <script type="text/javascript" src="https://cdn.ywxi.net/js/1.js" async></script>
</body>
</html>
